<!DOCTYPE html>
<html lang="en">
  <head>
    <title>IPsec and Network Security - 2025 TRex Testing (Finland, 20-28 Aug)</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Pelican" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./output.css" />
    <link rel="stylesheet" type="text/css" href="./highlights.css" />
    <link rel="icon" type="image/png" href="./images/favicon-192x192.png">




  </head>

  <body class="bg-slate-300 dark:bg-gray-800 text-black dark:text-neutral-200 text-xl">
    <div class="px-16 lg:px-32 2xl:px-80">
<header class="flex flex-row my-32">
  <a href="."><img class="size-28" src="./images/logo.png"></a>
  <nav class="flex-grow flex flex-row-reverse text-xl my-auto">
    <a class="p-3 no-underline hover:underline" href="./category/conferences">Conferences</a>
    <a class="p-3 no-underline hover:underline" href="./category/research">Research</a>
    <a class="p-3 no-underline hover:underline" href=".">Home</a>
  </nav>
</header>      <main>
<article>
  <header>
    <h2>
      2025 TRex Testing (Finland, 20-28 Aug)
    </h2>
  </header>
  <h2>Overview</h2>
<p>This guide provides a quick start for installing and testing TRex (Cisco's Traffic Generator) on Ubuntu 24.04 (Noble Numbat) and 25.04 (Plucky Puffin).</p>
<h3>Prerequisites</h3>
<p>Before installing TRex, ensure your system meets the following requirements:</p>
<ul>
<li><strong>Operating System:</strong> Ubuntu 24.04 LTS or Ubuntu 25.04</li>
<li><strong>Python:</strong> Python 3.9 (TRex v3.06 is tied to this version)</li>
<li><strong>CPU:</strong> Multi-core processor with NICs bound to the cores you are using</li>
<li><strong>Network:</strong> Tested with Mellanox ConnectX-5 or ConnectX-7</li>
<li><strong>DOCA-OFED:</strong> Must match your OS distribution â€” https://developer.nvidia.com/networking/doca</li>
</ul>
<h2>Installation</h2>
<h3>Installing TRex with Python 3.9</h3>
<p>For these tests, I used TRex v3.06 (as of July 2025). This version requires an
older Python runtime (3.8-3.9) than what ships with modern Linux distributions
such as Ubuntu 25.04.</p>
<p>Download the Python 3.9 source tarball:</p>
<p><code>wget https://www.python.org/ftp/python/3.9.13/Python-3.9.13.tgz</code></p>
<p>Extract it, run <code>configure</code>, and install.</p>
<p>To always use Python 3.9, create a virtual environment (one-time setup). After that, activate this venv every time you work with TRex.</p>
<p>Run this from <code>/root</code> or another persistent location:</p>
<div class="highlight"><pre><span></span><code>python3.9<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
</code></pre></div>

<h3>Log in and activate the Python 3.9 venv</h3>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/root
<span class="nb">source</span><span class="w"> </span>./venv/bin/activate
<span class="c1"># To verify:</span>
<span class="nb">type</span><span class="w"> </span>python3.9<span class="p">;</span><span class="w"> </span><span class="c1">#python3.9 is hashed (/root/venv/bin/python3.9)</span>
</code></pre></div>

<h2>Installing DOCA-OFED</h2>
<p>For setups using Mellanox ConnectX NICs, DOCA-OFED is required to ensure proper driver and DPDK support. Configuration details are provided at the end of this document.</p>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>https://www.mellanox.com/downloads/DOCA/DOCA_v3.0.0/host/doca-host_3.0.0-058000-25.04-ubuntu2504_amd64.deb
dpkg<span class="w"> </span>-i<span class="w"> </span>doca-host_3.0.0-058000-25.04-ubuntu2504_amd64.deb
apt<span class="w"> </span>update
apt<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>doca-ofed
dkms<span class="w"> </span>autoinstall
mst<span class="w"> </span>start
mst<span class="w"> </span>status<span class="w"> </span>-v
</code></pre></div>

<h3>Downloading TRex</h3>
<div class="highlight"><pre><span></span><code>wget<span class="w"> </span>--no-check-certificate<span class="w"> </span>--no-cache<span class="w"> </span>https://trex-tgn.cisco.com/trex/release/latest
tar<span class="w"> </span>xvf<span class="w"> </span>latest
mv<span class="w"> </span>v3.06<span class="w"> </span>trex-v3.06/
<span class="nb">cd</span><span class="w"> </span>trex-v3.06/
git<span class="w"> </span>init
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit
rm<span class="w">  </span>so/x86_64/libstdc++.so.6
<span class="nb">cd</span><span class="w"> </span>../
mv<span class="w"> </span>trex-v3.06<span class="w"> </span>/var/tmp
sysctl<span class="w"> </span>-w<span class="w"> </span>vm.nr_hugepages<span class="o">=</span><span class="m">2048</span><span class="w">  </span><span class="c1"># add this to /etc/sysctl.d to make it permanent.</span>
</code></pre></div>

<p>At the time of writing, <code>latest</code> pointed to v3.06.</p>
<h2>Starting TRex Server</h2>
<p>TRex is installed under <code>/var/tmp/trex-v3.06</code> on the sunset host.</p>
<div class="highlight"><pre><span></span><code>sysctl<span class="w"> </span>-w<span class="w"> </span>vm.nr_hugepages<span class="o">=</span><span class="m">2048</span>
<span class="nb">source</span><span class="w"> </span>/root/venv/bin/activate
<span class="nb">cd</span><span class="w"> </span>/var/tmp/trex-v3.06
./t-rex-64<span class="w"> </span>-i<span class="w"> </span>--no-scapy<span class="w"> </span>--cfg<span class="w"> </span>/etc/trex_cfg.yaml<span class="w"> </span>-c<span class="w"> </span><span class="m">8</span>
</code></pre></div>

<p>Start the TRex server once and leave it running in the foreground. I prefer to run it inside a <code>screen</code> session so you can reattach later with <code>screen -x</code> to see the output. The server must be started within the Python 3.9 venv.</p>
<p>I recommend starting <code>screen bash</code> from the activated virtual environment, then launching the TRex server inside that screen session.</p>
<p>It will take a few seconds to start and will remain running in the foreground.</p>
<h3>Running a TRex Test Script</h3>
<p>From a second terminal (also inside the Python 3.9 venv), run one of the test scripts. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/root/ietf-123-pcpu/tests-trex
./u1.py
./u1.py<span class="w"> </span>--src-ip<span class="w"> </span><span class="m">192</span>.0.1.253<span class="w"> </span>--dst-ip<span class="w"> </span><span class="m">192</span>.0.2.253<span class="w"> </span>--pps<span class="w"> </span>1M<span class="w"> </span>--frame-size<span class="w"> </span><span class="m">1518</span><span class="w"> </span>--flows<span class="w"> </span><span class="m">2</span><span class="w"> </span>--duration<span class="w"> </span><span class="m">10</span><span class="w"> </span>--flows-end<span class="w"> </span><span class="m">2</span><span class="w"> </span>--runs<span class="w"> </span><span class="m">2</span>
</code></pre></div>

<p><code>u1.py</code> is a simple UDP sender/receiver that measures throughput and packet loss. It stores results in JSON, which are later processed with Pandas and plotted using Matplotlib.</p>
<h2>Appendix A: Mellanox DOCA-OFED Diagnostics</h2>
<p>This section is only needed if you are troubleshooting your Mellanox NIC setup. If TRex starts and traffic flows, you can skip this.</p>
<p>After installing DOCA-OFED, run <code>mst start</code> once. To verify that your NICs are detected, check the output of <code>mst status -v</code>:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="n">mst</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">-</span><span class="n">v</span>
<span class="n">MST</span><span class="w"> </span><span class="n">modules</span><span class="p">:</span>
<span class="o">------------</span>
<span class="w">    </span><span class="n">MST</span><span class="w"> </span><span class="n">PCI</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">loaded</span>
<span class="w">    </span><span class="n">MST</span><span class="w"> </span><span class="n">PCI</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">loaded</span>
<span class="w">    </span><span class="o">-</span><span class="n">E</span><span class="o">-</span><span class="w"> </span><span class="n">Unknown</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="s2">&quot;--v&quot;</span>
<span class="n">root</span><span class="err">@</span><span class="n">sunset</span><span class="p">:</span><span class="o">~/</span><span class="n">ietf</span><span class="o">-</span><span class="mi">123</span><span class="o">-</span><span class="n">pcpu</span><span class="o">/</span><span class="n">tests</span><span class="o">-</span><span class="n">trex</span><span class="c1"># mst status -v</span>
<span class="n">MST</span><span class="w"> </span><span class="n">modules</span><span class="p">:</span>
<span class="o">------------</span>
<span class="w">    </span><span class="n">MST</span><span class="w"> </span><span class="n">PCI</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">loaded</span>
<span class="w">    </span><span class="n">MST</span><span class="w"> </span><span class="n">PCI</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">loaded</span>
<span class="n">PCI</span><span class="w"> </span><span class="n">devices</span><span class="p">:</span>
<span class="o">------------</span>
<span class="n">DEVICE_TYPE</span><span class="w">             </span><span class="n">MST</span><span class="w">                           </span><span class="n">PCI</span><span class="w">       </span><span class="n">RDMA</span><span class="w">                                               </span><span class="n">NET</span><span class="w">                                     </span><span class="n">NUMA</span>
<span class="n">ConnectX5</span><span class="p">(</span><span class="n">rev</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span><span class="w">        </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">mst</span><span class="o">/</span><span class="n">mt4121_pciconf0</span><span class="o">.</span><span class="mi">1</span><span class="w">    </span><span class="mi">01</span><span class="p">:</span><span class="mf">00.1</span><span class="w">   </span><span class="n">mlx5_1</span><span class="w">          </span><span class="n">net</span><span class="o">-</span><span class="n">redwest</span><span class="w">                             </span><span class="mi">0</span>

<span class="n">ConnectX5</span><span class="p">(</span><span class="n">rev</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span><span class="w">        </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">mst</span><span class="o">/</span><span class="n">mt4121_pciconf0</span><span class="w">      </span><span class="mi">01</span><span class="p">:</span><span class="mf">00.0</span><span class="w">   </span><span class="n">mlx5_0</span><span class="w">          </span><span class="n">net</span><span class="o">-</span><span class="n">redeast</span><span class="w">                             </span><span class="mi">0</span>
</code></pre></div>
  <footer>
    <!-- <p>Published: <time datetime="2025-08-28T00:00:00+00:00"> -->
    <!--     Thu 28 August 2025 -->
    <!--   </time></p> -->
    <p>
      <a href="./category/research.html">Research</a>
    </p>
  </footer>
</article>
      </main>
<footer class="flex flex-row mt-16 py-16 border-t-3 border-t-black dark:border-t-neutral-200">
  <a href="."><img class="size-28" src="./images/logo.png"></a>
  <a class="my-auto underline ms-auto" href="mailto:info@linux-ipsec.org">info@linux.ipsec.org</a>
</footer>    </div>
  </body>
</html>